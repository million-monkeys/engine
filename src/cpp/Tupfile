include_rules

BINARY_NAME = game
PCH = game

CFLAGS += -Wall -Werror -I. -Wno-delete-non-abstract-non-virtual-dtor
LINKER += -pthread -ldl -lSDL2 -lGL

INCLUDES += -I$(DEPENDENCIES)/cr/
INCLUDES += -I$(DEPENDENCIES)/entt/src
INCLUDES += -I$(DEPENDENCIES)/taskflow
INCLUDES += -I$(DEPENDENCIES)/toml11
INCLUDES += -I$(DEPENDENCIES)/glm
INCLUDES += -I$(DEPENDENCIES)/spdlog/include
INCLUDES += -I$(DEPENDENCIES)/cxxopts/include
INCLUDES += -I$(DEPENDENCIES)/physfs/src
INCLUDES += -I$(DEPENDENCIES)/physfshpp/include
INCLUDES += -I$(DEPENDENCIES)/orderedmap/include
INCLUDES += -I$(DEPENDENCIES)/immer
INCLUDES += -I$(DEPENDENCIES)/parallelhashmap/
INCLUDES += -I$(DEPENDENCIES)/stb
INCLUDES += -I$(DEPENDENCIES)/easy_profiler/easy_profiler_core/include
INCLUDES += -I$(DEPENDENCIES)/tinygltf

ifdef CONFIG_DEBUG_BUILD
    INCLUDES += -I$(DEPENDENCIES)/glad/debug/include
else
    INCLUDES += -I$(DEPENDENCIES)/glad/release/include
endif

# Compile PCH
: $(PCH).hpp |> !pch |> $(PCH).pch

# Compile Sources
: foreach core/*.cpp |> !compile-engine |>
: foreach graphics/*.cpp |> !compile-engine |>
: foreach graphics/renderer/*.cpp |> !compile-engine |>
: foreach memory/*.cpp |> !compile-engine |>
: foreach utils/*.cpp |> !compile-engine |>
: foreach $(DEPENDENCIES)/physfs/src/*.c |> !compile-c |>

# Link binary
: *.o $(DEPENDENCIES)/*.a |> !link-exe |>

# Preserve source files in debug build, for better debugging experience
ifdef CONFIG_DEBUG_BUILD_
: foreach core/*.cpp core/*.hpp |> !tup_preserve |>
: foreach utils/*.cpp utils/*.hpp |> !tup_preserve |>
endif
